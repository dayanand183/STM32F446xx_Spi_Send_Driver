/*
 * main_spi.c
 *
 *  Created on: 09-Feb-2026
 *      Author: dayanand
 */

#include "stm32f446xx.h"
#include <string.h>

//	SPI_Handle_t SPI1;

	/*
	 * PB12 --> SPI2_NSS
	 * PB13 --> SPI2_CLK
	 * PB14 --> SPI2_MISO
	 * PB15 --> SPI2_MOSI
	 * ALT Func Mode 5
	 */

void SPI2_GPIOInits(void)
{
	GPIO_Handle_t SPIPins;

	SPIPins.pGPIOx = GPIOB;
	SPIPins.GPIO_Config.Gpio_Pinmode = GPIO_ALTFUN_MODE;
	SPIPins.GPIO_Config.Gpio_Altfun = 5;
	SPIPins.GPIO_Config.Gpio_OPType = GPIO_OP_TYPE_PP;
	SPIPins.GPIO_Config.Gpio_PUPD = GPIO_NO_PU_PD;
	SPIPins.GPIO_Config.Gpio_Speed = GPIO_FAST_SPEED;

	// NSS
//	SPIPins.GPIO_Config.Gpio_PinNumber = GPIO_PIN_NO_12;
//	GPIO_InIt(&SPIPins);

	// CLK
	SPIPins.GPIO_Config.Gpio_PinNumber = GPIO_PIN_NO_13;
	GPIO_InIt(&SPIPins);

	// MISO
//	SPIPins.GPIO_Config.Gpio_PinNumber = GPIO_PIN_NO_14;
//	GPIO_InIt(&SPIPins);

	// MOSI
	SPIPins.GPIO_Config.Gpio_PinNumber = GPIO_PIN_NO_15;
	GPIO_InIt(&SPIPins);
}

void SPI2_Inits(void)
{
	SPI_Handle_t SPI2Handle;

	SPI2Handle.pSPIx = SPI2;
	SPI2Handle.SPI_Config.SPI_BusConfig = SPI_FULL_DUPLEX;
	SPI2Handle.SPI_Config.SPI_DeviceMode = SPI_DEVICE_MASTERMODE;
	SPI2Handle.SPI_Config.SPI_SclkSpeed = SPI_SCLK_SPEED_DIV2;
	SPI2Handle.SPI_Config.SPI_DFF = SPI_8BITS_DFF;
	SPI2Handle.SPI_Config.CPHA = SPI_CPHA_LOW;
	SPI2Handle.SPI_Config.CPOL = SPI_CPOL_LOW;
	SPI2Handle.SPI_Config.SSM = SPI_SSM_EN;

	SPI_InIt(&SPI2Handle);

}


int main(void)
{
 	char st[] = "Hello World";

	SPI2_GPIOInits();

	SPI2_Inits();

	// Enable the NSS high
	SPI_SSIConfig(SPI2, ENABLE);

	// Enable the SPI peripheral
	SPI_Enable(SPI2, ENABLE);

	// Send the data through SPI
	SPI_DataSend(SPI2, (uint8_t *)st, strlen(st));

	// // Lets confirm SPI is not busy
	 while( SPI_GetFlagStaus(SPI2, SPI_BUSY_FLAG) );

	// Disable the SPI peripheral
	SPI_Enable(SPI2, DISABLE);

	while(1);

	return 0;
}
